(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-27d56e65"],{"23ef":function(e,t,r){"use strict";r("dc63")},"4c53":function(e,t,r){"use strict";var a=r("23e7"),n=r("857a"),s=r("af03");a({target:"String",proto:!0,forced:s("sub")},{sub:function(){return n(this,"sub","","")}})},6876:function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"app-container"},[r("splitpanes",{ref:"mainSplit"},[r("pane",{attrs:{size:e.splitSize[0]}},[r("div",{staticClass:"split-container"},[r("h2",[e._v("歷史訂單查詢")]),r("TableView",{ref:"main",staticClass:"table",attrs:{data:e.data,"column-options":e.columnOptions[0],form:e.formBody[0],rules:e.rules[0],"table-options":{isCanSelection:!0,disableCreate:!0},page:e.page[0],"page-size":e.pageSize[0],target:0,loading:e.loading[0]},on:{search:e.getDataset,refresh:e.getDataset,delete:e.deleteDataset,create:e.createDataset,edit:e.editDataset,"select-row":e.onSelectRow,"size-change":e.handlePageSizeChange,"page-change":e.handlePageChange}})],1)]),r("pane",{attrs:{size:e.splitSize[1]}},[e.selectRow&&Object.keys(e.selectRow).length>0?r("div",{staticClass:"split-container"},[r("el-card",{directives:[{name:"loading",rawName:"v-loading",value:e.loading[1],expression:"loading[1]"}]},[r("template",{slot:"header"},[r("b",[e._v(e._s(e.selectRow.id)+" 訂單內容")])]),r("el-row",[r("el-col",{attrs:{md:6}},[r("el-timeline",{ref:"timeline"},[e._l(e.subData["timeline"],(function(t,a){return[t.timestamp?r("el-timeline-item",{key:a,attrs:{timestamp:t.timestamp}},[e._v(" "+e._s(e.$t("ORDER."+t.content))+" ")]):e._e()]}))],2)],1),r("el-col",{attrs:{md:18}},[r("KeyValueView",{attrs:{data:e.subData["result"],"format-func":e.formatValue}})],1)],1)],2)],1):e._e()])],1)],1)},n=[],s=(r("d3b7"),r("159b"),r("b64b"),r("4c53"),r("b0c0"),r("4ec3")),i=r("512e"),o=r("0253"),c=r("6464"),u=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-table",{staticStyle:{width:"100%"},attrs:{data:e.transferData,"show-header":!1}},[r("el-table-column",{attrs:{label:"key",prop:"key","min-width":"20%"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("b",[e._v(e._s(e.$t("ORDER."+t.row.key)))])]}}])}),r("el-table-column",{attrs:{label:"value",prop:"value"},scopedSlots:e._u([{key:"default",fn:function(t){return[Array.isArray(t.row.value)&&t.row.value.length>0?[r("el-table",{attrs:{data:t.row.value}},e._l(Object.keys(t.row.value[0]),(function(t){return r("el-table-column",{key:t,attrs:{label:e.$t("ORDER."+t),prop:t},scopedSlots:e._u([{key:"default",fn:function(r){return["object"===typeof r.row[t]&&r.row[t]?[e._v(" "+e._s(e.formatFunc?e.formatFunc(t,r.row[t]):r.row[t])+" ")]:[e._v(" "+e._s(r.row[t])+" ")]]}}],null,!0)})})),1)]:"object"===typeof t.row.value?[e._v(" "+e._s(t.row.value.name)+" ")]:[e._v(e._s(t.row.value))]]}}])})],1)},l=[],d={name:"KeyValueView",props:{data:{type:Object,default:function(){return{}}},formatFunc:{type:Function,default:function(){return[]}},translateKey:{type:String,default:null}},computed:{transferData:function(){var e=this,t=[];return Object.keys(this.data).forEach((function(r){t.push({key:r,value:e.data[r]})})),t}},mounted:function(){console.log(this.transferData)}},f=d,b=r("2877"),p=Object(b["a"])(f,u,l,!1,null,"38f58532",null),m=p.exports,h={name:"Menu",components:{Splitpanes:i["Splitpanes"],Pane:i["Pane"],TableView:o["a"],KeyValueView:m},data:function(){return{loading:[!1,!1],page:[1,1],pageSize:[10,10],splitSize:[50,50],data:[],selectRow:{},subData:[],selectSubRow:{},innerData:[]}},computed:{formBody:function(){return[[{label:"訂單狀態",field:"status",type:"text",inputType:"el-select",dataset:this.getStatusSelection,options:{filterable:!0}},{label:"顧客",field:"customer",type:"text",inputType:"el-select",dataset:this.getCustomerSelection,options:{filterable:!0}},{label:"已結帳",field:"checkOut",type:"text",inputType:"el-switch"},{label:"序號",field:"orderID",type:"number",inputType:"el-input-number"},{label:"桌號",field:"desk",type:"number",inputType:"el-input-number"},{label:"訂單來源",field:"orderFrom",type:"text",inputType:"el-radio-group",dataset:[{value:"C",label:"顧客點餐"},{value:"S",label:"來店點餐"},{value:"F",label:"FoodPanda"},{value:"U",label:"UberEats"}]},{label:"點餐內容",field:"orderDetails",type:"text",inputType:"OrderDetailField",dataset:this.getMenuSelection,options:{options:{master:"menu",child:"menuItem",combineField:"menuItemValue",value:"count"}}}]]},columnOptions:function(){return[[{label:"訂單狀態",field:"status.name",type:"text",inputType:"el-select"},{label:"顧客",field:"customer.name",type:"text",inputType:"el-select"},{label:"結帳狀況",field:"checkOut",type:"text",inputType:"el-radio-group"},{label:"序號",field:"orderID",type:"number",inputType:"number"},{label:"桌號",field:"desk",type:"number",inputType:"number"},{label:"產生時間",field:"createDateTime",type:"date",inputType:"datetime",dateInputFormat:"yyyy-MM-dd'T'HH:mm:ss",dateOutputFormat:"yyyy-MM-dd",formatFn:"function (value) { return value != null ? value : null}"},{label:"訂單來源",field:"orderFrom",type:"text",inputType:"text"}]]},rules:function(){return[{name:[{required:!0,message:"必填欄位",trigger:"blur"}]},{name:[{required:!0,message:"必填欄位",trigger:"blur"}],label:[{required:!0,message:"必填欄位",trigger:"blur"}],brand:[{required:!0,message:"必填欄位",trigger:"blur"}],unit:[{required:!0,message:"必填欄位",trigger:"blur"}]},{stockDate:[{required:!0,message:"必填欄位",trigger:"blur"}],expiryDate:[{required:!0,message:"必填欄位",trigger:"blur"}],material:[{required:!0,message:"必填欄位",trigger:"blur"}],stock:[{required:!0,message:"必填欄位",trigger:"blur"}]}]}},mounted:function(){this.getDataset()},methods:{getDataset:function(e){var t=this;this.$set(this.loading,0,!0);var r="?page="+this.page[0]+"&page_size="+this.pageSize[0];e&&(r+="&search="+e),Object(s["E"])(r).then((function(e){t.data=e.data,t.$refs["main"].formBody={},t.$refs["main"].editItem={}})).catch((function(e){Object(c["a"])("error","Error",e,!1)})).finally((function(){t.$set(t.loading,0,!1)}))},getStatusSelection:function(){return Object(s["F"])("?selection=name").then((function(e){return Promise.resolve(e.data)})).catch((function(e){return Object(c["a"])("error","Error",e,!1),Promise.reject()}))},getCustomerSelection:function(){return Object(s["u"])("?selection=name").then((function(e){return Promise.resolve(e.data)})).catch((function(e){return Object(c["a"])("error","Error",e,!1),Promise.reject()}))},getMenuSelection:function(){return Object(s["y"])("?selection=name&children=menuID").then((function(e){return Promise.resolve(e.data)})).catch((function(e){return Object(c["a"])("error","Error",e,!1),Promise.reject()}))},getLabelSelection:function(){return Object(s["v"])("?selection=name").then((function(e){return Promise.resolve(e.data)})).catch((function(e){return Object(c["a"])("error","Error",e,!1),Promise.reject()}))},getUnitSelection:function(){return Object(s["J"])("?selection=sign").then((function(e){return Promise.resolve(e.data)})).catch((function(e){return Object(c["a"])("error","Error",e,!1),Promise.reject()}))},deleteDataset:function(e){var t=this;Object(s["k"])(e.id).then((function(e){Object(c["a"])("success","Delete Success",e.data,!1),t.getDataset()})).catch((function(e){return e.response?Object(c["a"])("error","Error",e.response.data,!1):Object(c["a"])("error","Error",e,!1)}))},createDataset:function(e){var t=this;Object(s["U"])(e).then((function(e){Object(c["a"])("success","Create Success",e.data,!1),t.$refs["main"].createDialog=!1,t.$refs["main"].formBody={},t.$refs["main"].editItem={},t.getDataset()})).catch((function(e){return e.response?Object(c["a"])("error","Error",e.response.data,!1):Object(c["a"])("error","Error",e,!1)}))},editDataset:function(e){var t=this;Object(s["gb"])(e.id,e.data).then((function(e){Object(c["a"])("success","Edit Success",e.data,!1),t.$refs["main"].createDialog=!1,t.$refs["main"].formBody={},t.$refs["main"].editItem={},t.getDataset()})).catch((function(e){return e.response?Object(c["a"])("error","Error",e.response.data,!1):Object(c["a"])("error","Error",e,!1)}))},onSelectRow:function(e){this.selectRow=e,e&&(this.splitSize=[50,50,0],this.getSubDataset(e.id))},getSubDataset:function(e){var t=this;this.$set(this.loading,1,!0),Object(s["B"])(e).then((function(e){var r=e.data,a={};Object.keys(r).forEach((function(e){["timeline","status"].indexOf(e)<0&&(a[e]=r[e])})),t.subData={status:r["status"],timeline:r["timeline"],result:a}})).catch((function(e){Object(c["a"])("error","Error",e,!1)})).finally((function(){t.$set(t.loading,1,!1)}))},createSubDataset:function(e){var t=this;Object(s["V"])(e).then((function(e){Object(c["a"])("success","Create Success",e.data,!1),t.$refs["sub"].createDialog=!1,t.$refs["sub"].formBody={},t.$refs["sub"].editItem={},t.getSubDataset(t.selectRow.id)})).catch((function(e){return e.response?Object(c["a"])("error","Error",e.response.data,!1):Object(c["a"])("error","Error",e,!1)}))},editSubDataset:function(e){var t=this;Object(s["hb"])(e.id,e.data).then((function(e){Object(c["a"])("success","Edit Success",e.data,!1),t.$refs["sub"].createDialog=!1,t.$refs["sub"].formBody={},t.$refs["sub"].editItem={},t.getSubDataset(t.selectRow.id)})).catch((function(e){return e.response?Object(c["a"])("error","Error",e.response.data,!1):Object(c["a"])("error","Error",e,!1)}))},onSelectSubRow:function(e){this.selectSubRow=e,e&&(this.splitSize=[20,30,50],this.getInnerDataset(e.id))},getInnerDataset:function(e){var t=this;Object(s["H"])("?material="+e+"&page="+this.page[2]+"&page_size="+this.pageSize[2]).then((function(e){t.innerData=e.data})).catch((function(e){Object(c["a"])("error","Error",e,!1)}))},getInnerFormBody:function(){var e=this;Object(s["G"])().then((function(t){e.innerFormBody=t.data})).catch((function(e){Object(c["a"])("error","Error",e,!1)}))},deleteInnerDataset:function(e){var t=this;Object(s["m"])(e.id).then((function(e){Object(c["a"])("success","Delete Success",e.data,!1),t.getInnerDataset(t.selectSubRow.id)})).catch((function(e){Object(c["a"])("error","Error",e,!1)}))},createInnerDataset:function(e){var t=this;Object(s["W"])(e).then((function(e){Object(c["a"])("success","Create Success",e.data,!1),t.$refs["inner"].createDialog=!1,t.$refs["inner"].formBody={},t.$refs["inner"].editItem={},t.getInnerDataset(t.selectSubRow.id)})).catch((function(e){Object(c["a"])("error","Error",e,!1)}))},editInnerDataset:function(e){var t=this;Object(s["jb"])(e.id,e.data).then((function(e){Object(c["a"])("success","Edit Success",e.data,!1),t.$refs["inner"].createDialog=!1,t.$refs["inner"].formBody={},t.$refs["inner"].editItem={},t.getInnerDataset(t.selectSubRow.id)})).catch((function(e){return e.response?Object(c["a"])("error","Error",e.response.data,!1):Object(c["a"])("error","Error",e,!1)}))},handlePageSizeChange:function(e){switch(this.$set(this.pageSize,e[0],e[1]),e[0]){case 0:return this.getDataset();case 1:return this.getSubDataset(this.selectRow.id);case 2:return this.getInnerDataset(this.selectSubRow.id)}},handlePageChange:function(e){switch(this.$set(this.page,e[0],e[1]),e[0]){case 0:return this.getDataset();case 1:return this.getSubDataset(this.selectRow.id);case 2:return this.getInnerDataset(this.selectSubRow.id)}},formatValue:function(e,t){switch(e){case"menuItem":return t["name"]+"(現價："+t["price"]+"$)";default:return t["name"]}}}},g=h,y=(r("23ef"),Object(b["a"])(g,a,n,!1,null,null,null));t["default"]=y.exports},"857a":function(e,t,r){var a=r("1d80"),n=/"/g;e.exports=function(e,t,r,s){var i=String(a(e)),o="<"+t;return""!==r&&(o+=" "+r+'="'+String(s).replace(n,"&quot;")+'"'),o+">"+i+"</"+t+">"}},af03:function(e,t,r){var a=r("d039");e.exports=function(e){return a((function(){var t=""[e]('"');return t!==t.toLowerCase()||t.split('"').length>3}))}},dc63:function(e,t,r){}}]);