(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a95b1666"],{"0e3a":function(t,e,a){},"5ba0":function(t,e,a){"use strict";a("0e3a")},6464:function(t,e,a){"use strict";a.d(e,"a",(function(){return i})),a.d(e,"b",(function(){return l}));var n=a("5c96"),i=function(t,e,a,i){return Object(n["Notification"])({title:e,message:a,type:t,showClose:i})},l=function(t,e){return Object(n["Message"])({type:t,message:e})}},"8d99":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app-container"},[a("el-scrollbar",{attrs:{native:!1,"view-style":"{width:100%; height:100%;}"}},[a("el-row",[a("el-col",{attrs:{md:12}},[a("h1",[t._v("報表"),a("el-button",{attrs:{icon:"fas el-icon-fa-plus-circle",type:"primary"},on:{click:t.onAddChart}},[t._v("新增圖表")])],1)]),a("el-col",{staticClass:"align-right",attrs:{md:12}},[a("el-form",{attrs:{inline:""}},[a("el-form-item",[t._v(" 鎖定"),a("el-switch",{model:{value:t.canDrag,callback:function(e){t.canDrag=e},expression:"canDrag"}}),t._v("拖移 ")],1),a("el-form-item",[a("el-date-picker",{attrs:{type:"daterange"},model:{value:t.date,callback:function(e){t.date=e},expression:"date"}})],1)],1)],1)],1),a("el-row",{attrs:{gutter:10}},[a("draggable",{attrs:{list:t.chart,draggable:".item",disabled:!t.canDrag,"ghost-class":"ghost"}},t._l(t.chart,(function(e,n){return a("el-col",{key:n,staticClass:"item",attrs:{md:e.width}},[a("chart",{attrs:{index:n,data:t.data[n],filter:e,loading:t.loading[n]},on:{"change-width":t.onChangeWidth,"change-filter":t.onChangeFilter,"delete-chart":t.onDeleteChart}})],1)})),1)],1)],1)],1)},i=[],l=(a("d3b7"),a("b0c0"),a("a434"),a("4ec3")),r=a("6464"),s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-card",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}]},[a("div",{staticClass:"align-right",attrs:{slot:"header"},slot:"header"},[t.edit?[a("el-select",{staticStyle:{width:"100px"},model:{value:t.width,callback:function(e){t.width=e},expression:"width"}},[a("el-option",{attrs:{value:6,label:"1/4頁寬"}}),a("el-option",{attrs:{value:8,label:"1/3頁寬"}}),a("el-option",{attrs:{value:12,label:"1/2頁寬"}}),a("el-option",{attrs:{value:24,label:"整頁寬"}})],1),a("el-select",{staticStyle:{width:"100px"},model:{value:t.app,callback:function(e){t.app=e},expression:"app"}},t._l(t.selection.App,(function(t,e){return a("el-option",{key:e,attrs:{value:t.value,label:t.label}})})),1),a("el-select",{staticStyle:{width:"100px"},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}},t._l(t.selection.Columns,(function(t,e){return a("el-option",{key:e,attrs:{value:t.value,label:t.label}})})),1),a("el-select",{staticStyle:{width:"100px"},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}},t._l(t.selection.Value,(function(t,e){return a("el-option",{key:e,attrs:{value:t.value,label:t.label}})})),1),a("el-select",{staticStyle:{width:"100px"},model:{value:t.aggregation,callback:function(e){t.aggregation=e},expression:"aggregation"}},t._l(t.selection.aggregation,(function(t,e){return a("el-option",{key:e,attrs:{value:t.value,label:t.label}})})),1),a("el-select",{staticStyle:{width:"100px"},model:{value:t.chart,callback:function(e){t.chart=e},expression:"chart"}},t._l(t.selection.chart,(function(t,e){return a("el-option",{key:e,attrs:{value:t.value,label:t.label}})})),1),a("el-button",{attrs:{type:"primary",icon:"fas el-icon-fa-times"},on:{click:function(e){t.edit=!1}}})]:[a("el-button",{attrs:{type:"primary",icon:"fas el-icon-fa-edit"},on:{click:function(e){t.edit=!0}}}),a("el-button",{attrs:{type:"danger",icon:"fas el-icon-fa-trash-alt"},on:{click:t.deleteChart}})]],2),a("v-chart",{key:t.reload,staticStyle:{width:"100%"},attrs:{options:t.options,theme:"macarons"}})],1)},o=[],c=a("1da1"),u=(a("96cf"),a("a9e3"),a("d81d"),a("c740"),a("159b"),a("b64b"),a("4de4"),a("13d5"),a("7db0"),a("9ca8e"));a("ef97"),a("94b1"),a("c037"),a("e05f");a("817d");var h={name:"Chart",components:{"v-chart":u["a"]},props:{index:{type:Number,default:0},data:{type:Array,default:function(){return[]}},filter:{type:Object,default:function(){return{}}},loading:{type:Boolean,default:!1}},data:function(){return{width:6,app:null,name:null,value:null,aggregation:null,chart:null,reload:0,selection:{Columns:[],Value:[]},edit:!1,init:!0}},computed:{xAxisData:function(){return this.data.map((function(t){return t.name}))},series:function(){return this.data.map((function(t){return t.value}))},options:function(){var t=this.translateLabel("Columns",this.name)+" 的 "+this.translateLabel("Value",this.value)+" "+this.translateLabel("aggregation",this.aggregation)+this.translateLabel("chart",this.chart),e=this.translateLabel("App",this.app);switch(this.chart){case"bar":return{title:{text:t,subtext:e},xAxis:{type:"category",data:this.xAxisData},yAxis:{},series:[{name:"bar",type:"bar",showSymbol:!1,data:this.series}],animationDuration:500};case"line":return{title:{text:t,subtext:e},xAxis:{type:"category",data:this.xAxisData},yAxis:{},series:[{name:"line",type:"line",showSymbol:!1,data:this.series}],animationDuration:500};case"pie":return{title:{text:t,subtext:e},tooltip:{trigger:"name"},legend:{orient:"vertical",bottom:"bottom"},series:[{name:"pie",type:"pie",data:this.data}],animationDuration:500}}return{}}},watch:{width:function(){this.reload+=1,this.$emit("change-width",{index:this.index,width:this.width})},app:function(t){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function a(){var n,i,l,r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return e.reload+=1,e.$set(e.selection,"Columns",[]),e.$set(e.selection,"Value",[]),a.next=5,e.getAnalysisColumnsOptions(t);case 5:return n=a.sent,i=n.findIndex((function(t){return t.value===e.name})),i<0&&(e.name=n[0].value),a.next=10,e.getAnalysisValueOptions(t);case 10:if(l=a.sent,r=l.findIndex((function(t){return t.value===e.value})),r<0&&(e.value=l[0].value),e.init){a.next=16;break}return a.next=16,e.updateChart();case 16:case"end":return a.stop()}}),a)})))()},name:function(){var t=this;this.reload+=1;var e=this.selection["Columns"].findIndex((function(e){return e.value===t.value}));e<0&&(this.value=this.selection["Columns"][0].value),!this.init&&this.selection["Columns"].length>0&&this.updateChart()},value:function(){var t=this;this.reload+=1;var e=this.selection["Value"].findIndex((function(e){return e.value===t.value}));console.log(this.selection["Value"]),e<0&&this.selection["Value"].length>0&&(this.value=this.selection["Value"][0].value),!this.init&&this.selection["Value"].length>0&&this.updateChart()},aggregation:function(){this.reload+=1,this.init||this.updateChart()},chart:function(){this.reload+=1,this.init||this.updateChart()}},mounted:function(){var t=this;this.$set(this.selection,"aggregation",[{label:"平均",value:"Avg"},{label:"加總",value:"Sum"},{label:"筆數",value:"Count"},{label:"最小",value:"Min"},{label:"最大",value:"Max"}]),this.$set(this.selection,"chart",[{label:"長條圖",value:"bar"},{label:"折線圖",value:"line"},{label:"圓餅圖",value:"pie"}]),this.initAnalysis().then((function(){t.init=!1}))},methods:{initAnalysis:function(){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function e(){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return Object.keys(t.filter).forEach((function(e){t[e]=t.filter[e]})),e.next=3,t.getAnalysisAppOptions();case 3:return e.next=5,t.updateChart();case 5:return a=e.sent,e.abrupt("return",Promise.resolve(a));case 7:case"end":return e.stop()}}),e)})))()},getAnalysisAppOptions:function(){var t=this;Object(l["p"])().then((function(e){t.$set(t.selection,"App",e.data.result)}))},getAnalysisColumnsOptions:function(t){var e=this;return Object(l["q"])(t).then((function(t){return e.$set(e.selection,"Columns",t.data.result),Promise.resolve(t.data.result)}))},getAnalysisValueOptions:function(t){var e=this;return Object(l["s"])(t).then((function(t){return e.$set(e.selection,"Value",t.data.result),Promise.resolve(t.data.result)}))},updateChart:function(){var t=this,e=["width","app","name","value","aggregation","chart"],a=e.reduce((function(e,a){return!!t[a]&&e}),!0);return a&&this.$emit("change-filter",{index:this.index,width:this.width,app:this.app,name:this.name,value:this.value,aggregation:this.aggregation,chart:this.chart}),Promise.resolve(!0)},deleteChart:function(){this.$emit("delete-chart",{index:this.index,width:this.width,app:this.app,name:this.name,value:this.value,aggregation:this.aggregation,chart:this.chart})},translateLabel:function(t,e){if(this.selection[t]){var a=this.selection[t].find((function(t){return t.value===e}));if(a)return a.label}return e}}},d=h,p=a("2877"),f=Object(p["a"])(d,s,o,!1,null,null,null),g=f.exports,v=a("1980"),m=a.n(v),b=a("6f23"),y={name:"Customer",components:{Chart:g,draggable:m.a},data:function(){return{chart:[],data:[[]],loading:[],canDrag:!1,date:[(new Date).setDate((new Date).getDate()-30),(new Date).setDate((new Date).getDate()+1)],count:0}},watch:{chart:{deep:!0,handler:function(t){Object(l["Y"])(t).then((function(t){})).catch((function(t){Object(r["a"])("error","Error",t,!1)}))}},date:{deep:!0,handler:function(){this.chart=[],this.getDataset()}}},mounted:function(){this.getDataset()},methods:{getDataset:function(){var t=this;Object(l["r"])().then((function(e){t.chart=e.data})).catch((function(t){Object(r["a"])("error","Error",t,!1)}))},getAnalysisData:function(t,e,a,n,i){var s=this;this.$set(this.loading,t,!0),this.count+=1;var o="";this.date&&(o="&start_date="+Object(b["a"])(this.date[0],"yyyy-MM-dd")+"&end_date="+Object(b["a"])(this.date[1],"yyyy-MM-dd")),Object(l["o"])(i,e,a,n,o).then((function(e){s.$set(s.data,t,e.data.result)})).catch((function(t){Object(r["a"])("error","Error",t,!1)})).finally((function(){s.$set(s.loading,t,!1)}))},onChangeWidth:function(t){this.$set(this.chart[t["index"]],"width",t["width"])},onChangeFilter:function(t){this.getAnalysisData(t["index"],t["app"],t["name"],t["value"],t["aggregation"]),this.$set(this.chart,t["index"],t)},onAddChart:function(){this.chart.push({width:8,app:"Order",name:"createDateTime",value:"checkOutTotal",aggregation:"Sum",chart:"bar"}),this.data.push([])},onDeleteChart:function(t){this.chart.splice(this.chart.indexOf(t),1)}}},x=y,w=(a("5ba0"),Object(p["a"])(x,n,i,!1,null,"0e7202d6",null));e["default"]=w.exports}}]);