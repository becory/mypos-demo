(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-541b9987"],{"2aea":function(e,t,r){"use strict";r.r(t);var o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"app-container"},[r("splitpanes",{ref:"mainSplit"},[r("pane",{attrs:{size:e.splitSize[0]}},[r("splitpanes",{staticClass:"orderList",attrs:{horizontal:""}},[r("pane",{attrs:{size:e.splitOrder[0]}},[r("el-row",{staticClass:"customerOrder",attrs:{type:"flex"}},[r("el-card",{staticClass:"split-container order"},[r("template",{slot:"header"},[r("el-row",[r("el-col",{attrs:{span:10}},[r("el-select",{attrs:{filterable:"",remote:"","reserve-keyword":"","remote-method":e.searchCustomer,loading:e.loadingCustomer,"value-key":"id"},model:{value:e.order.customer,callback:function(t){e.$set(e.order,"customer",t)},expression:"order.customer"}},e._l(e.customerOptions,(function(e){return r("el-option",{key:e.id,attrs:{label:e.name+" - "+e.phone,value:e.id}})})),1)],1),r("el-col",{attrs:{span:3}},[r("el-input",{attrs:{placeholder:"桌號"},model:{value:e.order.desk,callback:function(t){e.$set(e.order,"desk",t)},expression:"order.desk"}})],1),r("el-col",{attrs:{span:5}},[r("el-select",{model:{value:e.order.orderFrom,callback:function(t){e.$set(e.order,"orderFrom",t)},expression:"order.orderFrom"}},[r("el-option",{attrs:{value:"C",label:"顧客自選"}}),r("el-option",{attrs:{value:"S",label:"店家"}}),r("el-option",{attrs:{value:"F",label:"FoodPanda"}}),r("el-option",{attrs:{value:"U",label:"UberEats"}})],1)],1),r("el-col",{staticClass:"align-right",attrs:{span:6}},[r("el-button",{directives:[{name:"touch",rawName:"v-touch:tap",value:e.toggleCalculator(),expression:"toggleCalculator()",arg:"tap"}],attrs:{icon:"fas el-icon-fa-calculator",type:"primary"}})],1)],1)],1),r("div",{staticClass:"order-card"},[r("el-alert",{attrs:{type:"info"}},[e._v(" 久按項目修改詳細資料 ")]),e._l(e.order.orderDetails,(function(t,o){return r("el-row",{directives:[{name:"touch",rawName:"v-touch:tap",value:function(){return e.onSelectRow(o,t)},expression:"()=>onSelectRow(idx, menuItem)",arg:"tap"},{name:"touch",rawName:"v-touch:longtap",value:function(){return e.onSelectRowEdit(o,t)},expression:"()=>onSelectRowEdit(idx, menuItem)",arg:"longtap"}],key:o,staticClass:"orderDetail",class:{selectRow:e.selectRow["index"]===o},attrs:{gutter:10}},[r("el-col",{staticClass:"count align-right",attrs:{span:4}},[t.count?r("span",[e._v(e._s(t.count))]):e._e()]),r("el-col",{attrs:{span:15}},[r("el-row",[r("el-col",[t.cook?r("el-tag",{attrs:{type:t.cook.className,size:"large",effect:"dark"}},[e._v(" "+e._s(t.cook.label)+" ")]):e._e(),r("b",[e._v(e._s(t.menuItem.name))]),r("div",{staticClass:"align-right"},[e._v("$"+e._s(Math.round(t.menuItem.price)))])],1),t.menuItem.menuSet?r("el-col",e._l(t.menuItem.menuSet,(function(t,o){return r("el-tag",{key:o},[e._v(" "+e._s(t.name)+" ")])})),1):e._e(),t.remark?r("el-col",[e._v(" **"+e._s(t.remark)+" ")]):e._e()],1)],1),r("el-col",{staticClass:"count align-right",attrs:{span:4}},[r("el-button",{attrs:{type:"danger",icon:"fas el-icon-fa-trash-alt"},on:{click:function(t){return e.removeOrderItem(o)}}})],1)],1)}))],2)],2)],1)],1),r("pane",{attrs:{size:e.splitOrder[1]}},[r("el-row",{staticClass:"align-right"},[e._v(e._s(e.order.orderDetails.length)+"項，"+e._s(e.totalCount)+"份")]),r("Keyboard",{on:{clickKeyboard:e.onKeyboard}})],1)],1),r("el-row",{attrs:{gutter:20}},[r("el-col",{attrs:{span:6}},[r("el-button",{directives:[{name:"touch",rawName:"v-touch:tap",value:function(){return e.onSave()},expression:"()=>onSave()",arg:"tap"}],attrs:{type:"primary",icon:"fas el-icon-fa-save"}},[e._v("暫存")])],1),r("el-col",{attrs:{span:17}},[r("DragButton",{attrs:{total:e.tempTotal(e.order.orderDetails)},on:{submit:e.onCheckOut}})],1)],1)],1),r("pane",{attrs:{size:e.splitSize[1]}},[r("el-row",{staticClass:"menu-container",attrs:{type:"flex"}},[r("el-card",{staticClass:"menu-container"},[r("el-tabs",{directives:[{name:"touch",rawName:"v-touch:swipe.left",value:e.onSwipe(),expression:"onSwipe()",arg:"swipe",modifiers:{left:!0}},{name:"touch",rawName:"v-touch:swipe.right",value:e.onSwipe(),expression:"onSwipe()",arg:"swipe",modifiers:{right:!0}}],staticClass:"menu-container",model:{value:e.tabPanel,callback:function(t){e.tabPanel=t},expression:"tabPanel"}},[e._l(e.menuList,(function(t,o){return[r("el-tab-pane",{key:t.id,attrs:{label:t.name,name:o.toString()}},[r("el-alert",{attrs:{type:"info"}},[e._v(" 滑動可翻頁 ")]),r("el-row",{staticClass:"menu",attrs:{gutter:20}},[e.filterMenuItem(t.id).length>0?e._l(e.filterMenuItem(t.id),(function(t,o){return r("el-col",{key:o,attrs:{span:6}},[r("el-card",{directives:[{name:"touch",rawName:"v-touch:tap",value:e.addOrderItem(t),expression:"addOrderItem(menuItem)",arg:"tap"}],staticClass:"item-card",attrs:{"body-style":{padding:"0px"}}},[r("el-image",{staticClass:"image",staticStyle:{width:"100%",height:"100%"},attrs:{fit:"cover",src:e.getImageUrl(t.image)}}),r("div",{staticClass:"bottom"},[r("span",[e._v(e._s(t.name))])])],1)],1)})):[r("el-alert",{attrs:{type:"warning"}},[r("h1",[e._v("沒有產品")])])]],2)],1)]}))],2)],1)],1)],1)],1),r("el-drawer",{attrs:{title:e.selectRow["row"]?"No."+(e.selectRow["index"]+1)+" - "+e.selectRow["row"]["menuItem"]["name"]:null,visible:e.editItemDrawer,direction:"rtl","append-to-body":!0,"destroy-on-close":!0},on:{"update:visible":function(t){e.editItemDrawer=t}}},[e.order["orderDetails"][e.selectRow["index"]]?r("el-form",[r("el-form-item",{attrs:{label:"烹調方式","label-width":"80px"}},[r("el-select",{attrs:{"value-key":"id"},model:{value:e.order["orderDetails"][e.selectRow["index"]]["cook"],callback:function(t){e.$set(e.order["orderDetails"][e.selectRow["index"]],"cook",t)},expression:"order['orderDetails'][selectRow['index']]['cook']"}},e._l(e.cookOptions,(function(e,t){return r("el-option",{key:t,attrs:{value:e,label:e.label}})})),1),r("el-button",{directives:[{name:"touch",rawName:"v-touch:tap",value:function(){return e.getCookSelection()},expression:"()=>getCookSelection()",arg:"tap"}],attrs:{icon:"fas el-icon-fa-sync-alt"}})],1),r("el-form-item",{attrs:{label:"備註","label-width":"80px"}},[r("el-input",{model:{value:e.order["orderDetails"][e.selectRow["index"]]["remark"],callback:function(t){e.$set(e.order["orderDetails"][e.selectRow["index"]],"remark",t)},expression:"order['orderDetails'][selectRow['index']]['remark']"}})],1)],1):e._e()],1)],1)},n=[],a=(r("13d5"),r("d3b7"),r("159b"),r("4de4"),r("c740"),r("d81d"),r("a434"),r("b64b"),r("25f0"),r("4ec3")),i=r("512e"),s=r("6464"),c=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-card",[e._l(e.button,(function(t,o){return r("el-row",{key:o,staticClass:"row-button",attrs:{gutter:10}},e._l(t,(function(t,o){return r("el-col",{key:o,attrs:{span:8}},[r("el-button",{on:{click:function(r){return e.onClick(t)}}},[e._v(e._s(t))])],1)})),1)})),r("el-row",{attrs:{gutter:10}},[r("el-col",{attrs:{span:16}},[r("el-button",{on:{click:function(t){return e.onClick(0)}}},[e._v("0")])],1),r("el-col",{attrs:{span:8}},[r("el-button",{attrs:{type:"danger"},on:{click:function(t){return e.onClick("C")}}},[e._v("C")])],1)],1)],2)},l=[],u={name:"Index",computed:{button:function(){return[[7,8,9],[4,5,6],[1,2,3]]}},methods:{onClick:function(e){this.$emit("clickKeyboard",e)}}},d=u,m=(r("484f"),r("2877")),f=Object(m["a"])(d,c,l,!1,null,"39b32040",null),h=f.exports,p=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-row",[r("el-col",[r("el-button",{directives:[{name:"touch",rawName:"v-touch:start",value:e.onStart(),expression:"onStart()",arg:"start"},{name:"touch",rawName:"v-touch:moving",value:e.onMove(),expression:"onMove()",arg:"moving"},{name:"touch",rawName:"v-touch:end",value:e.onEnd(),expression:"onEnd()",arg:"end"}],ref:"drag-button",staticStyle:{"z-index":"999",position:"absolute"},attrs:{type:"success",icon:"fas el-icon-fa-arrow-right"}},[e._v(e._s(e.mouseClick?"拉到底點一下":null)+"結帳 ")]),r("p",{staticStyle:{"text-align":"right"}},[e._v("總金額$"+e._s(e.total))])],1)],1)},b=[],g=(r("a9e3"),{name:"Index",props:{total:{type:Number,default:0}},data:function(){return{originX:0,oW:0,oLeft:0,mouseClick:!1}},computed:{test:function(){return{orderDetails:[{menuItem:["Incorrect type. Expected pk value, received dict."],cook:{non_field_errors:["Invalid data. Expected a dictionary, but got str."]}},{menuItem:["Incorrect type. Expected pk value, received dict."],cook:{non_field_errors:["Invalid data. Expected a dictionary, but got str."]}},{menuItem:["Incorrect type. Expected pk value, received dict."],cook:{non_field_errors:["Invalid data. Expected a dictionary, but got str."]}}]}}},mounted:function(){this.originX=this.$refs["drag-button"].$el.clientWidth+"px"},methods:{onStart:function(){var e=this;return function(t){if(t.touches){var r=t.touches[0];e.$refs["drag-button"].$el.style.position="absolute",e.oW=r.clientX-e.$refs["drag-button"].$el.offsetLeft}else e.mouseClick=!0,e.$refs["drag-button"].$el.style.position="absolute",e.oW=t.clientX-e.$refs["drag-button"].$el.offsetLeft}},onMove:function(){var e=this;return function(t){if(t.changedTouches){var r=t.changedTouches[0];e.oLeft=r.clientX-e.oW,e.oLeft<0?e.oLeft=0:e.oLeft>e.$el.clientWidth&&(e.oLeft=e.$el.clientWidth),e.$refs["drag-button"].$el.style.position="absolute",e.$refs["drag-button"].$el.style.left=e.oLeft+"px"}else e.mouseClick&&(e.oLeft=t.clientX-e.oW,e.oLeft<0?e.oLeft=0:e.oLeft>e.$el.clientWidth&&(e.oLeft=e.$el.clientWidth),e.$refs["drag-button"].$el.style.position="absolute",e.$refs["drag-button"].$el.style.left=e.oLeft+"px")}},onEnd:function(){var e=this;return function(t){t.touches?e.oLeft>=e.$el.clientWidth&&e.$emit("submit"):(e.mouseClick=!1,e.oLeft>=e.$el.clientWidth-e.$refs["drag-button"].$el.clientWidth/2&&(e.$emit("submit"),e.oLeft=0)),e.$refs["drag-button"].$el.style.position="absolute",e.$refs["drag-button"].$el.style.left="0px"}}}}),v=g,k=Object(m["a"])(v,p,b,!1,null,"510c4756",null),O=k.exports,w={name:"Menu",components:{DragButton:O,Keyboard:h,Splitpanes:i["Splitpanes"],Pane:i["Pane"]},data:function(){return{splitSize:[30,70],splitOrder:[95,5],tabPanel:0,menuList:[],menuItemList:[],order:{customer:1,orderDetails:[],orderFrom:"S"},selectRow:{},keyboardValue:"",editItemDrawer:!1,cookOptions:[],customerOptions:[],loadingCustomer:!1}},computed:{totalCount:function(){return this.order.orderDetails.reduce((function(e,t){return e+t.count}),0)}},mounted:function(){this.getDataset(),this.getMenuItem(),this.getCookSelection(),this.$route.params.id?this.getOrderData():this.initCustomer(1)},methods:{initCustomer:function(e){var t=this;Object(a["u"])("?id="+e).then((function(e){t.customerOptions=e.data.result})).finally((function(){t.loadingCustomer=!1}))},getOrderData:function(){var e=this;Object(a["D"])(this.$route.params.id).then((function(t){e.order=t.data,e.order.customer=e.order.customer.id,e.order.orderDetails.forEach((function(e){""===e["cook"]&&(e["cook"]=null),e["remark"]||(e["remark"]=""),delete e["transactionItem"],delete e["transactionCost"]})),e.initCustomer(e.order.customer),e.edit=!0})).catch((function(){Object(s["a"])("error","錯誤","取得資料失敗"),e.$router.push({name:"Order"})}))},getDataset:function(){var e=this;Object(a["y"])("?visible=true").then((function(t){e.menuList=t.data.result})).catch((function(e){Object(s["a"])("error","Error",e,!1)}))},getMenuItem:function(){var e=this;Object(a["x"])("").then((function(t){e.menuItemList=t.data.result})).catch((function(e){Object(s["a"])("error","Error",e,!1)}))},filterMenuItem:function(e){return this.menuItemList.filter((function(t){return t.menu.id===e}))},getCookSelection:function(){var e=this;Object(a["t"])("").then((function(t){e.cookOptions=t.data.result})).catch((function(e){return Object(s["a"])("error","Error",e,!1),Promise.reject()}))},getCustomerSelection:function(){return Object(a["u"])("?selection=name").then((function(e){return Promise.resolve(e.data)})).catch((function(e){return Object(s["a"])("error","Error",e,!1),Promise.reject()}))},getMenuSelection:function(){return Object(a["y"])("?selection=name&children=menuID").then((function(e){return Promise.resolve(e.data)})).catch((function(e){return Object(s["a"])("error","Error",e,!1),Promise.reject()}))},getLabelSelection:function(){return Object(a["v"])("?selection=name").then((function(e){return Promise.resolve(e.data)})).catch((function(e){return Object(s["a"])("error","Error",e,!1),Promise.reject()}))},getUnitSelection:function(){return Object(a["J"])("?selection=sign").then((function(e){return Promise.resolve(e.data)})).catch((function(e){return Object(s["a"])("error","Error",e,!1),Promise.reject()}))},deleteDataset:function(e){var t=this;Object(a["k"])(e.id).then((function(e){Object(s["a"])("success","Delete Success",e.data,!1),t.getDataset()})).catch((function(e){return e.response?Object(s["a"])("error","Error",e.response.data,!1):Object(s["a"])("error","Error",e,!1)}))},createDataset:function(e){var t=this;Object(a["U"])(e).then((function(e){Object(s["a"])("success","Create Success",e.data,!1),t.$refs["main"].createDialog=!1,t.$refs["main"].formBody={},t.$refs["main"].editItem={},t.getDataset()})).catch((function(e){return e.response?Object(s["a"])("error","Error",e.response.data,!1):Object(s["a"])("error","Error",e,!1)}))},editDataset:function(e){var t=this;Object(a["gb"])(e.id,e.data).then((function(e){Object(s["a"])("success","Edit Success",e.data,!1),t.$refs["main"].createDialog=!1,t.$refs["main"].formBody={},t.$refs["main"].editItem={},t.getDataset()})).catch((function(e){return e.response?Object(s["a"])("error","Error",e.response.data,!1):Object(s["a"])("error","Error",e,!1)}))},onSelectRow:function(e,t){this.selectRow={index:e,row:t},this.keyboardValue="",this.checkOrderItem()},onSelectRowEdit:function(e,t){this.selectRow={index:e,row:t},this.editItemDrawer=!0,this.keyboardValue="",this.checkOrderItem()},cleanSelectRow:function(){this.$set(this.$data,"selectRow",{}),this.keyboardValue="",this.checkOrderItem()},addOrderItem:function(e){var t=this;return function(){t.cleanSelectRow();var r={count:1,menuItem:e,cook:null,remark:""},o=t.order.orderDetails.findIndex((function(e){return JSON.stringify(e["menuItem"])===JSON.stringify(r["menuItem"])&&e["remark"]===r["remark"]&&e["cook"]===r["cook"]}));o>=0?t.$set(t.order.orderDetails[o],"count",t.order.orderDetails[o]["count"]+1):t.order.orderDetails.push(r),t.checkOrderItem()}},checkOrderItem:function(){this.order.orderDetails.map((function(e){return 0!==e["count"]&&e["count"]||(e["count"]=1),e}))},editSelectRow:function(e){var t=this,r=this.order.orderDetails.findIndex((function(e){return JSON.stringify(e)===JSON.stringify(t.selectRow["row"])}));r>=0&&(this.$set(this.order.orderDetails,r,Object.assign(this.order.orderDetails[r],e)),this.$set(this.selectRow,"row",Object.assign(this.selectRow["row"],e)))},removeOrderItem:function(e){e>=0&&this.order.orderDetails.splice(e,1),this.cleanSelectRow()},onKeyboard:function(e){Object.keys(this.selectRow).length>0&&("C"===e?(this.keyboardValue="",this.editSelectRow({count:1})):(this.keyboardValue+=e.toString(),this.editSelectRow({count:parseInt(this.keyboardValue)})),this.checkOrderItem())},onSwipe:function(){var e=this;return function(t,r){console.log(t,r);var o,n=parseInt(e.tabPanel);o="right"===t?n+1:n-1,e.menuList.length-1<o?e.tabPanel="0":e.tabPanel=o<0?(e.menuList.length-1).toString():o.toString()}},toggleCalculator:function(){var e=this;return function(){e.splitOrder[1]<40?e.splitOrder=[55,45]:e.splitOrder=[93,7]}},apiOrder:function(e){return this.edit?Object(a["gb"])(this.$route.params.id,e):Object(a["U"])(e)},onSave:function(){var e=this,t=JSON.parse(JSON.stringify(this.order));t["checkOut"]=!1,this.apiOrder(this.order).then((function(){Object(s["a"])("success","儲存成功，尚未結帳","訂單已儲存"),e.order={customer:1,orderDetails:[],orderFrom:"S"},e.edit&&e.$router.push({name:"Dashboard"})})).catch((function(e){return e.response?Object(s["a"])("error","Error",e.response.data,!1):Object(s["a"])("error","Error",e,!1)}))},onCheckOut:function(){var e=this,t=JSON.parse(JSON.stringify(this.order));console.log(t),t["checkOut"]=!0,this.apiOrder(t).then((function(){Object(s["a"])("success","結帳成功","訂單已儲存"),e.order={customer:1,orderDetails:[],orderFrom:"S"},e.edit&&e.$router.push({name:"Dashboard"})})).catch((function(e){return e.response?Object(s["a"])("error","Error",e.response.data,!1):Object(s["a"])("error","Error",e,!1)}))},searchCustomer:function(e){var t=this;""!==e?(this.loadingCustomer=!0,Object(a["u"])("?search="+e).then((function(e){t.customerOptions=e.data.result})).finally((function(){t.loadingCustomer=!1}))):this.customerOptions=[]},tempTotal:function(e){return e.length<=0?0:e.reduce((function(e,t){return t.count*t.menuItem.price+e}),0)},getImageUrl:function(e){return e?""+e:e}}},y=w,S=(r("f23e"),Object(m["a"])(y,o,n,!1,null,"8f8540b6",null));t["default"]=S.exports},"484f":function(e,t,r){"use strict";r("8ee5")},6464:function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return a}));var o=r("5c96"),n=function(e,t,r,n){return Object(o["Notification"])({title:t,message:r,type:e,showClose:n})},a=function(e,t){return Object(o["Message"])({type:e,message:t})}},"8e78":function(e,t,r){},"8ee5":function(e,t,r){},f23e:function(e,t,r){"use strict";r("8e78")}}]);